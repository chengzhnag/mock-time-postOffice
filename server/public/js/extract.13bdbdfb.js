(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["extract"],{2708:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var n={data:function(){return{}},filters:{},methods:{validEmail:function(t,e,r){console.log(e);var n=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;n.test(e)||r(new Error("邮箱格式不正确")),r()}}}},"365c":function(t,e,r){"use strict";r.d(e,"f",(function(){return i})),r.d(e,"h",(function(){return c})),r.d(e,"d",(function(){return l})),r.d(e,"b",(function(){return u})),r.d(e,"a",(function(){return m})),r.d(e,"e",(function(){return d})),r.d(e,"c",(function(){return f})),r.d(e,"g",(function(){return p}));r("d3b7");var n=r("bc3a"),a=r.n(n);a.a.defaults.withCredentials=!0;var s=a.a.create({baseURL:"",timeout:8e3});s.interceptors.request.use((function(t){return console.log("config: ",t),t}),(function(t){return console.log(t),Promise.reject()})),s.interceptors.response.use((function(t){if(200===t.status)return t.data;Promise.reject()}),(function(t){return console.log(t),Promise.reject()}));var o=s,i=function(t){return o({url:"/send",method:"post",data:t})},c=function(t){return o({url:"/extract",method:"post",data:t})},l=function(t){return o({url:"/getPublicLetter",method:"get",params:t})},u=function(t){return o({url:"/getAllLetter",method:"get",params:t})},m=function(t){return o({url:"/byExtractGetEmail",method:"post",data:t})},d=function(t){return o({url:"/getQuestion",method:"get",params:t})},f=function(t){return o({url:"/getEmail",method:"get",params:t})},p=function(t){return o({url:"/tips",method:"post",data:t})}},"36c1":function(t,e,r){},"729f":function(t,e,r){"use strict";r.r(e);var n,a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"extract-box"},[t.isSendSuccess?r("div",{staticClass:"message-box"},[r("span",[t._v(" 本页面将在 "),r("span",{staticClass:"error-msg"},[t._v(t._s(t.countDown))]),t._v(" 秒后过期 ")]),r("span",[t._v("在未来的某一天,")]),r("span",[t._v("我们将为你把邮件发送到你刚刚填写的邮箱中去")]),r("span",[t._v("或者,")]),r("span",[t._v("请保存你获得的提取码, 到期后即可手动提取")]),r("span",{staticClass:"important"},[t._v(t._s(t.extractCode))]),r("span",[t._v("将提取码发至以下邮箱(也可修改为他人的邮箱, 请朋友来领取):")]),r("span",[t._v("为确保收到我们的时光信,")]),r("span",[t._v(" 最好将 "),r("span",{staticClass:"error-msg"},[t._v(t._s(t.configEamil))]),t._v(" 放入邮箱白名单哦 ^_^ ")]),r("el-form",{ref:"sendForm",staticClass:"send-success",attrs:{model:t.sendForm,rules:t.sendRules,size:"small","label-position":"left"}},[r("el-form-item",{staticStyle:{width:"40%"},attrs:{prop:"email"}},[r("el-input",{attrs:{placeholder:"请把提取码发送至这个邮箱"},model:{value:t.sendForm.email,callback:function(e){t.$set(t.sendForm,"email",e)},expression:"sendForm.email"}})],1),r("el-form-item",[r("el-button",{staticStyle:{width:"120px"},attrs:{type:"primary"},on:{click:function(e){return t.submitForm("sendForm")}}},[t._v("发送")])],1)],1)],1):r("div",[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"190px",size:"small","label-position":"left"}},[r("el-form-item",{attrs:{label:"请填写提取码",prop:"extract"}},[r("el-input",{attrs:{placeholder:"输入曾经收到的提取码, 手工提取时光信件"},model:{value:t.ruleForm.extract,callback:function(e){t.$set(t.ruleForm,"extract",e)},expression:"ruleForm.extract"}})],1),r("el-form-item",{staticStyle:{"text-align":"right"}},[r("el-button",{staticStyle:{width:"120px"},attrs:{type:"primary"},on:{click:function(e){return t.extract("ruleForm")}}},[t._v("我要提取")])],1)],1),r("div",{staticClass:"tips"},[t._v("导航栏向右滑动还有关注我们的故事☞☞☞")])],1)])},s=[],o=r("ade3"),i=(r("eca7"),r("450d"),r("3787")),c=r.n(i),l=(r("425f"),r("4105")),u=r.n(l),m=(r("b0c0"),r("365c")),d=r("2708"),f={components:(n={},Object(o["a"])(n,u.a.name,u.a),Object(o["a"])(n,c.a.name,c.a),n),mixins:[d["a"]],data:function(){return{ruleForm:{extract:""},rules:{extract:[{required:!0,message:"请输入您的提取码",trigger:"blur"}]},isSendSuccess:!1,sendForm:{email:""},sendRules:{email:[{required:!0,message:"请输入目标邮箱",trigger:"blur"},{validator:this.validEmail,trigger:"blur"}]},extractCode:"",countDown:100,interval:null,configEamil:"***"}},beforeMount:function(){},mounted:function(){var t=this,e=this.$storage.read("email-data");console.log(e),e&&(Object(m["c"])().then((function(e){t.configEamil=e.data||"***"})),this.isSendSuccess=!0,this.extractCode=e["extractCode"]||"",this.sendForm.email=e["receiptEmail"]||"",this.interval=setInterval((function(){t.countDown=t.countDown-1,t.countDown||(clearInterval(t.interval),t.$router.push("/"))}),1e3),this.$storage.remove("email-data"))},methods:{submitForm:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return console.log("error submit!!"),!1;var r={receiptEmail:e.sendForm.email,extract:e.extractCode},n=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(m["h"])(r).then((function(t){n.close(),t.statusCode?e.funcMessageBox():e.$message.error(t.message)})).catch((function(t){n.close(),e.$message.error("发送提取码失败, 请稍后重试")}))}))},extract:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return console.log("error submit!!"),!1;var r={extract:e.ruleForm.extract};Object(m["a"])(r).then((function(t){t.statusCode?(e.$storage.write("extract-data",t.data||{}),e.$router.push("public")):e.$message.error(t.message)})).catch((function(t){e.$message.error("发送提取码失败, 请稍后重试")}))}))},funcMessageBox:function(){var t=this.$createElement;this.$msgbox({title:"消息",message:t("p",{style:"display: flex;flex-direction: column;"},[t("span",null,"成功发送, 如果未能收到, 请"),t("span",{style:"margin-top: 20px"},"1. 确认邮箱地址正确;"),t("span",null,"2. 翻看垃圾箱"),t("span",null,"3. 稍后重试")]),showCancelButton:!1,confirmButtonText:"确定"})}},beforeDestroy:function(){console.log("********beforeDestroy********"),this.interval&&(clearInterval(this.interval),this.interval=null)}},p=f,g=(r("eab7"),r("2877")),v=Object(g["a"])(p,a,s,!1,null,"b7d7f86c",null);e["default"]=v.exports},eab7:function(t,e,r){"use strict";r("36c1")}}]);